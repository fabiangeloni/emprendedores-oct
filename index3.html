<script>
  // Ruta absoluta al JSON en GitHub Pages
  const urlJSON = 'https://fabiangeloni.github.io/emprendedores-oct/json/empresas.json';

  async function inicializar() {
    try {
      const response = await fetch(urlJSON);
      if (!response.ok) throw new Error("No se pudo cargar el JSON");
      const empresas = await response.json();

      // Obtener parámetro "id" de la URL
      const params = new URLSearchParams(window.location.search);
      const empresaId = parseInt(params.get('id'));

      // Buscar empresa por ID
      let empresa = empresas.find(e => e.id === empresaId);

      if (!empresa) {
        empresa = empresas[0]; // fallback si no encuentra
      }

      // Fondo dinámico
      const seccionPerfil = document.querySelector('.perfil');
      if (empresa.fotos && empresa.fotos.length > 0) {
        seccionPerfil.style.backgroundImage = `url('${empresa.fotos[0]}')`;
      }

      // Foto y nombre
      document.querySelector('.logo img').src = empresa.fotoPerfil;
      document.querySelector('.logo img').alt = empresa.nombre;
      document.querySelector('.nombre-emprendimiento h2').textContent = empresa.nombre;

      // Título dinámico
      document.title = empresa.nombre + " - Microemprendedores Colón";

      // Iconos de contacto
      const iconos = document.querySelector('.iconos-contacto');
      iconos.innerHTML = `
        <a href="tel:${empresa.telefono}" target="_blank"><i class="fas fa-phone"></i></a>
        <a href="https://www.google.com/maps?q=${encodeURIComponent(empresa.empresa + ' ' + empresa.direccion)}" target="_blank"><i class="fas fa-map-marker-alt"></i></a>
        <a href="${empresa.instagram}" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="${empresa.facebook}" target="_blank"><i class="fab fa-facebook-f"></i></a>
      `;

      // Botón WhatsApp
      document.querySelector('.boton-wsp a').href = `https://wa.me/54${empresa.telefono}`;

      // Descripciones
      document.querySelector('.descripcion .breve').textContent = empresa.descripcionCorta;
      document.querySelector('.descripcion .larga').textContent = empresa.descripcionLarga;

      // Carrusel
      const carrusel = document.getElementById('carruselTrack');
      const repeticiones = 4;
      let contenidoCarrusel = "";
      for (let i = 0; i < repeticiones; i++) {
        contenidoCarrusel += empresa.fotos
          .map(foto => `<div class="carrusel-slide"><img src="${foto}" alt="${empresa.nombre}" /></div>`)
          .join('');
      }
      carrusel.innerHTML = contenidoCarrusel;

    } catch (error) {
      console.error("Error al cargar empresas:", error);
    }
  }

  inicializar();
</script>
